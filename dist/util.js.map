{"version":3,"file":"util.js","sourceRoot":"","sources":["../src/util.ts"],"names":[],"mappings":"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","sourcesContent":["import { addHexPrefix, isValidAddress, bufferToHex } from 'ethereumjs-util';\nimport BigNumber from 'bignumber.js';\nimport { ethErrors } from 'eth-rpc-errors';\nimport { TYPED_MESSAGE_SCHEMA, typedSignatureHash } from 'eth-sig-util';\nimport { Transaction, FetchAllOptions } from './transaction/TransactionController';\nimport { MessageParams } from './message-manager/MessageManager';\nimport { PersonalMessageParams } from './message-manager/PersonalMessageManager';\nimport { TypedMessageParams } from './message-manager/TypedMessageManager';\nimport { Token } from './assets/TokenRatesController';\n\nconst jsonschema = require('jsonschema');\nconst { BN, stripHexPrefix } = require('ethereumjs-util');\nconst ensNamehash = require('eth-ens-namehash');\n\nconst hexRe = /^[0-9A-Fa-f]+$/gu;\n\nconst NORMALIZERS: { [param in keyof Transaction]: any } = {\n  data: (data: string) => addHexPrefix(data),\n  from: (from: string) => addHexPrefix(from).toLowerCase(),\n  gas: (gas: string) => addHexPrefix(gas),\n  gasPrice: (gasPrice: string) => addHexPrefix(gasPrice),\n  nonce: (nonce: string) => addHexPrefix(nonce),\n  to: (to: string) => addHexPrefix(to).toLowerCase(),\n  value: (value: string) => addHexPrefix(value),\n};\n\n/**\n * Converts a BN object to a hex string with a '0x' prefix\n *\n * @param inputBn - BN instance to convert to a hex string\n * @returns - '0x'-prefixed hex string\n *\n */\nexport function BNToHex(inputBn: any) {\n  return addHexPrefix(inputBn.toString(16));\n}\n\n/**\n * Used to multiply a BN by a fraction\n *\n * @param targetBN - Number to multiply by a fraction\n * @param numerator - Numerator of the fraction multiplier\n * @param denominator - Denominator of the fraction multiplier\n * @returns - Product of the multiplication\n */\nexport function fractionBN(targetBN: any, numerator: number | string, denominator: number | string) {\n  const numBN = new BN(numerator);\n  const denomBN = new BN(denominator);\n  return targetBN.mul(numBN).div(denomBN);\n}\n\n/**\n * Return a URL that can be used to obtain ETH for a given network\n *\n * @param networkCode - Network code of desired network\n * @param address - Address to deposit obtained ETH\n * @param amount - How much ETH is desired\n * @returns - URL to buy ETH based on network\n */\nexport function getBuyURL(networkCode = '1', address?: string, amount = 5) {\n  switch (networkCode) {\n    case '1':\n      return `https://buy.coinbase.com/?code=9ec56d01-7e81-5017-930c-513daa27bb6a&amount=${amount}&address=${address}&crypto_currency=ETH`;\n    case '3':\n      return 'https://faucet.metamask.io/';\n    case '4':\n      return 'https://www.rinkeby.io/';\n    case '5':\n      return 'https://goerli-faucet.slock.it/';\n    case '42':\n      return 'https://github.com/kovan-testnet/faucet';\n  }\n}\n\n/**\n * Return a URL that can be used to fetch ETH transactions\n *\n * @param networkType - Network type of desired network\n * @param address - Address to get the transactions from\n * @param fromBlock? - Block from which transactions are needed\n * @returns - URL to fetch the transactions from\n */\nexport function getEtherscanApiUrl(networkType: string, address: string, fromBlock?: string): string {\n  let etherscanSubdomain = 'api';\n  /* istanbul ignore next */\n  if (networkType !== 'mainnet') {\n    etherscanSubdomain = `api-${networkType}`;\n  }\n  const apiUrl = `https://${etherscanSubdomain}.etherscan.io`;\n  let url = `${apiUrl}/api?module=account&action=txlist&address=${address}&tag=latest&page=1`;\n  if (fromBlock) {\n    url += `&startBlock=${fromBlock}`;\n  }\n  return url;\n}\n\n/**\n * Return a URL that can be used to fetch ERC20 token transactions\n *\n * @param networkType - Network type of desired network\n * @param address - Address to get the transactions from\n * @param opt? - Object that can contain fromBlock and Alethio service API key\n * @returns - URL to fetch the transactions from\n */\nexport function getAlethioApiUrl(networkType: string, address: string, opt?: FetchAllOptions) {\n  if (networkType !== 'mainnet') {\n    return { url: '', headers: {} };\n  }\n  let url = `https://api.aleth.io/v1/token-transfers?filter[to]=${address}`;\n  // From alethio implementation\n  // cursor = hardcoded prefix `0x00` + fromBlock in hex format + max possible tx index `ffff`\n  let fromBlock = opt && opt.fromBlock;\n  if (fromBlock) {\n    fromBlock = parseInt(fromBlock).toString(16);\n    let prev = `0x00${fromBlock}ffff`;\n    while (prev.length < 34) {\n      prev += '0';\n    }\n    url += `&page[prev]=${prev}`;\n  }\n  /* istanbul ignore next */\n  const headers = opt && opt.alethioApiKey ? { Authorization: `Bearer ${opt.alethioApiKey}` } : undefined;\n  return { url, headers };\n}\n\n/**\n * Handles the fetch of incoming transactions\n *\n * @param networkType - Network type of desired network\n * @param address - Address to get the transactions from\n * @param opt? - Object that can contain fromBlock and Alethio service API key\n * @returns - Responses for both ETH and ERC20 token transactions\n */\nexport async function handleTransactionFetch(\n  networkType: string,\n  address: string,\n  opt?: FetchAllOptions,\n): Promise<[{ [result: string]: [] }, { [data: string]: [] }]> {\n  const url = getEtherscanApiUrl(networkType, address, opt && opt.fromBlock);\n  const etherscanResponsePromise = handleFetch(url);\n  const alethioUrl = getAlethioApiUrl(networkType, address, opt);\n  const alethioResponsePromise = alethioUrl.url !== '' && handleFetch(alethioUrl.url, { headers: alethioUrl.headers });\n  let [etherscanResponse, alethioResponse] = await Promise.all([etherscanResponsePromise, alethioResponsePromise]);\n  if (etherscanResponse.status === '0' || etherscanResponse.result.length <= 0) {\n    etherscanResponse = { result: [] };\n  }\n  if (!alethioUrl.url || !alethioResponse || !alethioResponse.data) {\n    alethioResponse = { data: [] };\n  }\n  return [etherscanResponse, alethioResponse];\n}\n\n/**\n * Converts a hex string to a BN object\n *\n * @param inputHex - Number represented as a hex string\n * @returns - A BN instance\n *\n */\nexport function hexToBN(inputHex: string) {\n  return new BN(stripHexPrefix(inputHex), 16);\n}\n\n/**\n * A helper function that converts hex data to human readable string\n *\n * @param hex - The hex string to convert to string\n * @returns - A human readable string conversion\n *\n */\nexport function hexToText(hex: string) {\n  try {\n    const stripped = stripHexPrefix(hex);\n    const buff = Buffer.from(stripped, 'hex');\n    return buff.toString('utf8');\n  } catch (e) {\n    /* istanbul ignore next */\n    return hex;\n  }\n}\n\n/**\n * Given the standard set of information about a transaction, returns a transaction properly formatted for\n * publishing via JSON RPC and web3\n *\n * @param {boolean} [sendToken] - Indicates whether or not the transaciton is a token transaction\n * @param {string} data - A hex string containing the data to include in the transaction\n * @param {string} to - A hex address of the tx recipient address\n * @param {string} amount - A hex amount, in case of a token tranaction will be set to Tx value\n * @param {string} from - A hex address of the tx sender address\n * @param {string} gas - A hex representation of the gas value for the transaction\n * @param {string} gasPrice - A hex representation of the gas price for the transaction\n * @returns {object} An object ready for submission to the blockchain, with all values appropriately hex prefixed\n */\nexport function constructTxParams({\n  sendToken,\n  data,\n  to,\n  amount,\n  from,\n  gas,\n  gasPrice,\n}: {\n  sendToken?: boolean;\n  data?: string;\n  to?: string;\n  from: string;\n  gas?: string;\n  gasPrice?: string;\n  amount?: string;\n}): any {\n  const txParams: Transaction = {\n    data,\n    from,\n    value: '0',\n    gas,\n    gasPrice,\n  };\n\n  if (!sendToken) {\n    txParams.value = amount;\n    txParams.to = to;\n  }\n  return normalizeTransaction(txParams);\n}\n\n/**\n * Normalizes properties on a Transaction object\n *\n * @param transaction - Transaction object to normalize\n * @returns - Normalized Transaction object\n */\nexport function normalizeTransaction(transaction: Transaction) {\n  const normalizedTransaction: Transaction = { from: '' };\n  let key: keyof Transaction;\n  for (key in NORMALIZERS) {\n    if (transaction[key as keyof Transaction]) {\n      normalizedTransaction[key] = NORMALIZERS[key](transaction[key]) as never;\n    }\n  }\n  return normalizedTransaction;\n}\n\n/**\n * Execute and return an asynchronous operation without throwing errors\n *\n * @param operation - Function returning a Promise\n * @param logError - Determines if the error should be logged\n * @param retry - Function called if an error is caught\n * @returns - Promise resolving to the result of the async operation\n */\nexport async function safelyExecute(operation: () => Promise<any>, logError = false, retry?: (error: Error) => void) {\n  try {\n    return await operation();\n  } catch (error) {\n    /* istanbul ignore next */\n    if (logError) {\n      console.error(error);\n    }\n    retry && retry(error);\n  }\n}\n\n/**\n * Validates a Transaction object for required properties and throws in\n * the event of any validation error.\n *\n * @param transaction - Transaction object to validate\n */\nexport function validateTransaction(transaction: Transaction) {\n  if (!transaction.from || typeof transaction.from !== 'string' || !isValidAddress(transaction.from)) {\n    throw new Error(`Invalid \"from\" address: ${transaction.from} must be a valid string.`);\n  }\n  if (transaction.to === '0x' || transaction.to === undefined) {\n    if (transaction.data) {\n      delete transaction.to;\n    } else {\n      throw new Error(`Invalid \"to\" address: ${transaction.to} must be a valid string.`);\n    }\n  } else if (transaction.to !== undefined && !isValidAddress(transaction.to)) {\n    throw new Error(`Invalid \"to\" address: ${transaction.to} must be a valid string.`);\n  }\n  if (transaction.value !== undefined) {\n    const value = transaction.value.toString();\n    if (value.includes('-')) {\n      throw new Error(`Invalid \"value\": ${value} is not a positive number.`);\n    }\n    if (value.includes('.')) {\n      throw new Error(`Invalid \"value\": ${value} number must be denominated in wei.`);\n    }\n    const intValue = parseInt(transaction.value, 10);\n    const isValid =\n      Number.isFinite(intValue) && !Number.isNaN(intValue) && !isNaN(Number(value)) && Number.isSafeInteger(intValue);\n    if (!isValid) {\n      throw new Error(`Invalid \"value\": ${value} number must be a valid number.`);\n    }\n  }\n}\n\n/**\n * A helper function that converts rawmessageData buffer data to a hex, or just returns the data if\n * it is already formatted as a hex.\n *\n * @param data - The buffer data to convert to a hex\n * @returns - A hex string conversion of the buffer data\n *\n */\nexport function normalizeMessageData(data: string) {\n  try {\n    const stripped = stripHexPrefix(data);\n    if (stripped.match(hexRe)) {\n      return addHexPrefix(stripped);\n    }\n  } catch (e) {\n    /* istanbul ignore next */\n  }\n  return bufferToHex(Buffer.from(data, 'utf8'));\n}\n\n/**\n * Validates a PersonalMessageParams and MessageParams objects for required properties and throws in\n * the event of any validation error.\n *\n * @param messageData - PersonalMessageParams object to validate\n */\nexport function validateSignMessageData(messageData: PersonalMessageParams | MessageParams) {\n  if (!messageData.from || typeof messageData.from !== 'string' || !isValidAddress(messageData.from)) {\n    throw new Error(`Invalid \"from\" address: ${messageData.from} must be a valid string.`);\n  }\n  if (!messageData.data || typeof messageData.data !== 'string') {\n    throw new Error(`Invalid message \"data\": ${messageData.data} must be a valid string.`);\n  }\n}\n\n/**\n * Validates a TypedMessageParams object for required properties and throws in\n * the event of any validation error for eth_signTypedMessage_V1.\n *\n * @param messageData - TypedMessageParams object to validate\n * @param activeChainId - Active chain id\n */\nexport function validateTypedSignMessageDataV1(messageData: TypedMessageParams) {\n  if (!messageData.from || typeof messageData.from !== 'string' || !isValidAddress(messageData.from)) {\n    throw new Error(`Invalid \"from\" address: ${messageData.from} must be a valid string.`);\n  }\n  if (!messageData.data || !Array.isArray(messageData.data)) {\n    throw new Error(`Invalid message \"data\": ${messageData.data} must be a valid array.`);\n  }\n  try {\n    // typedSignatureHash will throw if the data is invalid.\n    typedSignatureHash(messageData.data as any);\n  } catch (e) {\n    throw new Error(`Expected EIP712 typed data.`);\n  }\n}\n\n/**\n * Validates a TypedMessageParams object for required properties and throws in\n * the event of any validation error for eth_signTypedMessage_V3.\n *\n * @param messageData - TypedMessageParams object to validate\n */\nexport function validateTypedSignMessageDataV3(messageData: TypedMessageParams) {\n  if (!messageData.from || typeof messageData.from !== 'string' || !isValidAddress(messageData.from)) {\n    throw new Error(`Invalid \"from\" address: ${messageData.from} must be a valid string.`);\n  }\n  if (!messageData.data || typeof messageData.data !== 'string') {\n    throw new Error(`Invalid message \"data\": ${messageData.data} must be a valid array.`);\n  }\n  let data;\n  try {\n    data = JSON.parse(messageData.data);\n  } catch (e) {\n    throw new Error('Data must be passed as a valid JSON string.');\n  }\n  const validation = jsonschema.validate(data, TYPED_MESSAGE_SCHEMA);\n  if (validation.errors.length > 0) {\n    throw new Error('Data must conform to EIP-712 schema. See https://git.io/fNtcx.');\n  }\n}\n\n/**\n * Validates a ERC20 token to be added with EIP747.\n *\n * @param token - Token object to validate\n */\nexport function validateTokenToWatch(token: Token) {\n  const { address, symbol, decimals } = token;\n  if (!address || !symbol || typeof decimals === 'undefined') {\n    throw ethErrors.rpc.invalidParams(`Must specify address, symbol, and decimals.`);\n  }\n  if (typeof symbol !== 'string') {\n    throw ethErrors.rpc.invalidParams(`Invalid symbol: not a string.`);\n  }\n  if (symbol.length > 6) {\n    throw ethErrors.rpc.invalidParams(`Invalid symbol \"${symbol}\": longer than 6 characters.`);\n  }\n  const numDecimals = parseInt((decimals as unknown) as string, 10);\n  if (isNaN(numDecimals) || numDecimals > 36 || numDecimals < 0) {\n    throw ethErrors.rpc.invalidParams(`Invalid decimals \"${decimals}\": must be 0 <= 36.`);\n  }\n  if (!isValidAddress(address)) {\n    throw ethErrors.rpc.invalidParams(`Invalid address \"${address}\".`);\n  }\n}\n\n/**\n * Returns wether the given code corresponds to a smart contract\n *\n * @returns {string} - Corresponding code to review\n */\nexport function isSmartContractCode(code: string) {\n  /* istanbul ignore if */\n  if (!code) {\n    return false;\n  }\n  // Geth will return '0x', and ganache-core v2.2.1 will return '0x0'\n  const smartContractCode = code !== '0x' && code !== '0x0';\n  return smartContractCode;\n}\n\n/**\n * Execute fetch and verify that the response was successful\n *\n * @param request - Request information\n * @param options - Options\n * @returns - Promise resolving to the fetch response\n */\nexport async function successfulFetch(request: string, options?: RequestInit) {\n  const response = await fetch(request, options);\n  if (!response.ok) {\n    throw new Error(`Fetch failed with status '${response.status}' for request '${request}'`);\n  }\n  return response;\n}\n\n/**\n * Execute fetch and return object response\n *\n * @param request - Request information\n * @param options - Options\n * @returns - Promise resolving to the result object of fetch\n */\nexport async function handleFetch(request: string, options?: RequestInit) {\n  const response = await successfulFetch(request, options);\n  const object = await response.json();\n\n  return object;\n}\n\n/**\n * Fetch that fails after timeout\n *\n * @param url - Url to fetch\n * @param options - Options to send with the request\n * @param timeout - Timeout to fail request\n *\n * @returns - Promise resolving the request\n */\nexport async function timeoutFetch(url: string, options?: RequestInit, timeout = 500): Promise<any> {\n  return Promise.race([\n    handleFetch(url, options),\n    new Promise<void>((_, reject) =>\n      setTimeout(() => {\n        reject(new Error('timeout'));\n      }, timeout),\n    ),\n  ]);\n}\n\n/**\n * Normalizes the given ENS name.\n *\n * @param {string} ensName - The ENS name\n *\n * @returns - the normalized ENS name string\n */\nexport function normalizeEnsName(ensName: string): string | null {\n  if (ensName && typeof ensName === 'string') {\n    try {\n      const normalized = ensNamehash.normalize(ensName.trim());\n      // this regex is only sufficient with the above call to ensNamehash.normalize\n      // TODO: change 7 in regex to 3 when shorter ENS domains are live\n      // eslint-disable-next-line require-unicode-regexp\n      if (normalized.match(/^(([\\w\\d\\-]+)\\.)*[\\w\\d\\-]{7,}\\.(eth|test)$/)) {\n        return normalized;\n      }\n    } catch (_) {\n      // do nothing\n    }\n  }\n  return null;\n}\n\nexport function calcTokenAmount(value: number | BigNumber, decimals: number) {\n  const multiplier = Math.pow(10, Number(decimals || 0));\n  return new BigNumber(value).div(multiplier);\n}\n\n/**\n * Query format using current provided eth query object\n * @param method - Method to query\n * @param ethQuery - EthQuery object\n * @param args - Conveninent arguments to execute the query\n * @returns - Promise resolving to the respective result\n */\nexport async function query(method: string, ethQuery: any, args: any[] = []): Promise<any> {\n  return new Promise((resolve, reject) => {\n    ethQuery[method](...args, (error: Error, result: any) => {\n      /* istanbul ignore next */\n      if (error) {\n        reject(error);\n        return;\n      }\n      resolve(result);\n    });\n  });\n}\n\n/**\n * Estimates required gas for a given transaction\n *\n * @param transaction - Transaction object to estimate gas for\n * @returns - Promise resolving to an object containing gas and gasPrice\n */\nexport async function estimateGas(transaction: Transaction, ethQuery: any) {\n  const estimatedTransaction = { ...transaction };\n  const { value, data } = estimatedTransaction;\n  const { gasLimit } = await query('getBlockByNumber', ethQuery, ['latest', false]);\n  estimatedTransaction.data = !data ? data : /* istanbul ignore next */ addHexPrefix(data);\n  // 3. If this is a contract address, safely estimate gas using RPC\n  estimatedTransaction.value = typeof value === 'undefined' ? '0x0' : /* istanbul ignore next */ value;\n  const gasHex = await query('estimateGas', ethQuery, [estimatedTransaction]);\n  return { blockGasLimit: gasLimit, gas: addHexPrefix(gasHex) };\n}\n\nexport default {\n  BNToHex,\n  fractionBN,\n  getBuyURL,\n  handleFetch,\n  hexToBN,\n  hexToText,\n  isSmartContractCode,\n  constructTxParams,\n  normalizeTransaction,\n  safelyExecute,\n  successfulFetch,\n  timeoutFetch,\n  validateTokenToWatch,\n  validateTransaction,\n  validateTypedSignMessageDataV1,\n  validateTypedSignMessageDataV3,\n  calcTokenAmount,\n  estimateGas,\n  query,\n};\n"]}